%! suppress = MissingImport
%! suppress = MissingBibliographystyle
%! suppress = DiscouragedUseOfDef
%! suppress = NonMatchingIf
%! suppress = Makeatletter
% Packages
% --------
\usepackage{amsfonts}
\usepackage{blindtext}
\usepackage[utf8]{inputenc}
\usepackage{lmodern}
\usepackage[swedish,english]{babel}
\usepackage{todonotes}
\usepackage{csquotes}
\usepackage{enumitem}
\usepackage{caption}   % to align the table caption to the right/left
\usepackage{subcaption}
\usepackage{placeins}
\usepackage{multirow}
\usepackage{fancyhdr}
\usepackage{lscape}
\usepackage{indentfirst}
\usepackage{mathrsfs}
\usepackage{amssymb}  % assumes amsmath package installed
\usepackage{amsthm}
\usepackage{amsmath}
\usepackage[newfloat]{minted} % must be loaded after amsmath
\usepackage{relsize}
\usepackage{mathtools}
\usepackage[d]{esvect}
\usepackage{epstopdf}
\usepackage{epigraph}
\usepackage[
    giveninits=false,
    style=ieee,
    sorting=appearance-date-name,
    sortcites,
    hyperref,
    mincitenames=1,
    maxcitenames=2,
    maxbibnames=10,
    minbibnames=1,
    citestyle=numeric-comp, % for [1, 2] instead of [1], [2]
    backend=biber
]{biblatex}
\usepackage[colorlinks=true]{hyperref}
\usepackage{bookmark}
\usepackage{chngcntr}
\usepackage{tocloft}
\usepackage[capitalize,nameinlink]{cleveref}
\usepackage{graphicx}
\usepackage{bm}
\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage{algpascal}
\usepackage{multicol}
\usepackage{lipsum}
%\usepackage[shortcuts]{glossaries}
\usepackage[nogroupskip,nonumberlist,automake,shortcuts,acronym]{glossaries-extra}
\usepackage{glossaries-prefix}
\usepackage{glossary-mcols}
\usepackage{booktabs}
\usepackage{tabularx}
\usepackage{makecell}
\usepackage[detect-weight=true,detect-family=true,binary-units=true,list-units=single,range-units=single]{siunitx}
\usepackage{xcolor}
\usepackage{pagecolor}
\usepackage{pgfplots}
\usepackage{tikz}
\usepackage{tikzpeople}
\usepackage[export]{adjustbox}
\usepackage{pgf-umlsd}
\usepackage[Sonny]{fncychap}
\usepackage{xparse}
\usepackage{appendix}
\usepackage[all]{hypcap}
\usepackage{soul}
%\usepackage{wrapfig2}

% enumitem
\newlist{inlineenum}{enumerate*}{1}
\setlist*[inlineenum]{
    label=(\arabic*),
    itemjoin={{; }},
    itemjoin*={{; and }},
}

% glossary settings
\setglossarystyle{mcolindexgroup}
\setabbreviationstyle[acronym]{long-short-user}
\glstoctrue%
\makeglossaries%
\loadglsentries{body/glossary.tex}

% bibliography settings
% sorting by order of appearance, then by date, then name
\DeclareSortingScheme{appearance-date-name}{
    \sort{
        \field{presort}
    }
    \sort[final]{
        \field{sortkey}
    }
    \sort{\citeorder}
    \sort{
        \field{sortyear}
        \field{year}
    }
    \sort{
        \field{sortname}
        \field{author}
        \field{editor}
        \field{translator}
        \field{sorttitle}
        \field{title}
    }
}


\bibliography{references,bibliography/bibliography}
% included papers
\DeclareBibliographyCategory{thesispapers}
\addtocategory{thesispapers}{olguinmunoz2018demoscaling}
\addtocategory{thesispapers}{olguinmunoz2019edgedroid}
\addtocategory{thesispapers}{olguinmunoz2021impact}
\addtocategory{thesispapers}{olguinmunoz2023realistic}
\addtocategory{thesispapers}{olguinmunoz2022cleave}
\addtocategory{thesispapers}{olguinmunoz2022ainur}
\newcommand{\citeallnames}%
{\AtNextCite{\defcounter{maxnames}{99}}\citename}

\makeatletter
\newcommand{\int@suppauthtitle}{%
    \def\ifciteibid{\@secondoftwo}%
    \renewbibmacro*{cite:name}{}%
    \renewbibmacro*{cite:idem}{}%
    \renewbibmacro*{author}{}%
    \renewbibmacro*{editor+others}{}%
    \renewbibmacro*{translator+others}{}%
    \renewbibmacro*{url}{}%
    \renewbibmacro*{in:}{Refereed article published in\\}%
    \renewbibmacro*{title}{}%
    \renewbibmacro*{annotation}{}%
    \renewbibmacro*{}{}%
    \renewbibmacro*{journal}{%
        \ifboolexpr{
            test {\iffieldundef{journaltitle}}
            and
            test {\iffieldundef{journalsubtitle}}
        }
        {}
        {\printtext[journaltitle]{%
            \normalfont{Refereed article published in}\\
            \printfield[titlecase]{journaltitle}%
            \setunit{\subtitlepunct}%
            \printfield[titlecase]{journalsubtitle}}}}
}%
\newcommand{\suppauthtitle}{\AtNextCite{\int@suppauthtitle}}
\makeatother

% listings setup (minted)
\SetupFloatingEnvironment{listing}{name=List.,within=none}

% table captions
\captionsetup[table]{justification=centerlast,
    labelsep=newline,
    font=sf,
    textfont=footnotesize}

% headers
\pagestyle{fancy}
\fancyhf{}
\fancyhead[LE,RO]{\thepage}
\fancyhead[RE]{\leftmark}
\fancyhead[LO]{\rightmark}

% SI settings
\sisetup{list-final-separator = {, and }}
\DeclareSIUnit{\belmilliwatt}{Bm}
\DeclareSIUnit{\dBm}{\deci\belmilliwatt}


% PGF and TIKZ settings
\pgfplotsset{compat=1.14}
\usetikzlibrary{tikzmark,calc,decorations.pathreplacing,shapes,shapes.symbols,arrows.meta,positioning,automata}
\input{publications/2018DemoScalingOnTheEdge/pgf-umlsd-ex}

% from ToMC preamble
\newcommand{\edgedroid}{EdgeDroid~\num{2.0}}
\newcommand*\dif{\,\mathrm{d}}
\newcommand*\df{\mathrm{d}}
\newcommand*\ts{T_{\text{s}}}

% appendix settings
\crefname{appendixwithoutnumber}{appendix}{appendices}
\crefformat{appendixwithoutnumber}{#2the \appendixname#3}
\Crefformat{appendixwithoutnumber}{#2The \appendixname#3}

% ack and dedication sections section
\newenvironment{acks}{\section*{Acknowledgements}}{}
\newenvironment{dedication}%
{\cleardoublepage\null\vspace{\stretch{1}}\begin{flushright}\itshape}
    {\end{flushright}\vspace{\stretch{2}}\null}


% toc and subsection settings
\setsecnumdepth{subsection}
\setcounter{tocdepth}{2}
\setlength{\cftsectionindent}{0pt} % Remove indent for \section
\setlength{\cftsubsectionindent}{0pt} % Remove indent for \subsection
\setlength{\cftsubsubsectionindent}{0pt}
\renewcommand{\cftchapteraftersnum}{:} % for ToC ``Chapter:''

% chapter and paper ``chapter'' settings
\counterwithin{chapter}{part} % reset chapter numbering after part change
\renewcommand*{\thechapter}{\arabic{chapter}} % remove part number from chapter name
\ChNameVar{\normalfont\large\rmfamily}
\ChNumVar{\normalfont\rmfamily\bfseries}
\ChTitleVar{\normalfont\rmfamily\huge}

\renewcommand{\chaptermark}[1]{\markboth{#1}{}}
\definecolor{titlecolor}{HTML}{ECCEF5}

\renewcommand\cftchaptername{\chaptername~}
\newcommand\newchaptername{Paper}
\crefname{paper}{Paper}{Papers}

\newcommand{\thesispaper}[2]
{
    \glsresetall% % reset all acronyms
    \edef\stitle{#1}
    \edef\ptitle{\citefield{#2}{title}}
    \edef\plabel{paper:#2}

    \cleardoublepage%
    \begin{titlingpage*}
        \newpagecolor{titlecolor}
        \chapter[\stitle]{\ptitle}\label[paper]{\plabel}

        \begin{flushright}
        {\citeallnames{#2}{author}}

            \vspace{3em}

            \suppauthtitle\fullcite{#2}
        \end{flushright}

        \thispagestyle{empty}
        \clearpage%
        \hspace{0pt}\vfill%
        \noindent\textcopyright~{\citeyear{#2}~\citelist{#2}{publisher}}

        \noindent{Layout has been revised and formulations and terms may have been altered for thesis consistency}

        \vfill\hspace{0pt}%
    \end{titlingpage*}%
    \restorepagecolor%
}

\newcommand{\preprintthesispaper}[4]
{
    \glsresetall%
    \edef\stitle{#1}
    \edef\ptitle{\citefield{#2}{title}}
    \edef\plabel{paper:#2}

    \cleardoublepage%
    \begin{titlingpage*}
        \newpagecolor{titlecolor}
        \chapter[\stitle]{\ptitle}\label[paper]{\plabel}

        \begin{flushright}
        {\citeallnames{#2}{author}}

            \vspace{3em}

            Article submitted to~\emph{#3}\\
            \vspace{1em}%
            Submitted for review on #4
        \end{flushright}

        \thispagestyle{empty}
        \clearpage%
        \hspace{0pt}\vfill%
        \noindent\textcopyright~{\citeyear{#2}~\citeauthor{#2}}

        \noindent{Layout has been revised and formulations and terms may have been altered for thesis consistency}

        \vfill\hspace{0pt}%
    \end{titlingpage*}%
    \restorepagecolor%
}

% ``theorem'' styles for conclusions
\theoremstyle{definition}
\newtheorem{conclusion}{Conclusion}[section]


% citation needed for when writing to mark where a reference needs to go
\newcommand{\citationeeded}{\todo{Citation needed}}
