% package by Martin Isaksson
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{kthpaper}

\newcounter{includedpaper}

\RequirePackage{tikz}
\RequirePackage{pgfplots}
\RequirePackage{geometry}

\usetikzlibrary{positioning,shapes.misc}
\usetikzlibrary{decorations.pathmorphing}

\tikzset{weird fill/.style={text=white,
        text height=24pt,
        text width=55mm,
        minimum width=73.6mm, minimum height=20mm,
        inner xsep=24pt, append after command={%
   \pgfextra
        \fill[sharp corners, fill=#1]%
    (\tikzlastnode.west)%
    [rounded corners=4pt] |- (\tikzlastnode.north)%
    [rounded corners=0pt] -| (\tikzlastnode.east)%
    [rounded corners=0pt] |- (\tikzlastnode.south)%
    [rounded corners=4pt] -| (\tikzlastnode.west);
   \endpgfextra}}}

\newcommand{\includepaper}{
\refstepcounter{includedpaper}
\thispagestyle{empty}
\newgeometry{margin=0cm}
\noindent
\begin{tikzpicture}
\node [ shift={(-36.5mm, -10mm - 30 mm * \value{includedpaper} - 2.5mm)},
            weird fill=kth-blue, anchor=mid]  at (current page.north east)%
            {\normalfont\sffamily\bfseries\Huge{}Paper~\Alph{includedpaper}};
     %workaround
    \path (current page.south west) rectangle (current page.north east);
\end{tikzpicture}
\restoregeometry
}

\newcommand{\paper}[3]{
\cleardoublepage
\includepaper
\ifgfivepaper
 \newgeometry{top=50mm,bottom=30mm,left=62mm,right=18mm}
\else
 \newgeometry{top=50mm,bottom=30mm,left=50mm,right=35mm}
\fi
\thispagestyle{empty}
\ifinswedish\selectlanguage{swedish}\fi
\begin{Huge}
  \begin{flushleft}
    \color{kth-blue}\noindent\sffamily\bfseries Paper~\Alph{includedpaper} \par
  \end{flushleft}
\end{Huge}
\ifx\@subtitle\@empty\relax
\else
\begin{Large}
  \vspace{1ex}
  \begin{flushleft}
    \noindent\sffamily\bfseries #1
  \end{flushleft}
\end{Large}
\fi
\vspace{.5\baselineskip}
\begin{large}
  \begin{flushleft}
%    \sffamily\MakeUppercase{#2}
#2
  \end{flushleft}
\end{large}

\vspace{10mm}

\begin{flushleft}
%  \emph{Published in}\\
  #3
\end{flushleft}

\restoregeometry
\cleardoublepage
}